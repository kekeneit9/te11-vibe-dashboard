<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Team Vibe Check Dashboard ‚ú®</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card h3 {
            margin-bottom: 15px;
            color: #333;
            font-size: 1.2rem;
        }

        .mood-indicator {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
        }

        .mood-score {
            font-size: 3rem;
            font-weight: bold;
            color: #667eea;
        }

        .mood-emoji {
            font-size: 2.5rem;
        }

        .traffic-light {
            width: 100%;
            height: 20px;
            border-radius: 10px;
            margin: 10px 0;
            position: relative;
        }

        .traffic-light.green { background: linear-gradient(90deg, #4CAF50, #8BC34A); }
        .traffic-light.yellow { background: linear-gradient(90deg, #FF9800, #FFC107); }
        .traffic-light.red { background: linear-gradient(90deg, #F44336, #FF5722); }

        .team-responses {
            display: grid;
            gap: 10px;
        }

        .response-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .response-emoji {
            font-size: 1.5rem;
            margin-left: 10px;
        }

        .blockers-list {
            list-style: none;
            max-height: 200px;
            overflow-y: auto;
        }

        .blockers-list li {
            padding: 8px 0;
            border-bottom: 1px solid #eee;
            font-style: italic;
            color: #666;
        }

        .blockers-list li:last-child {
            border-bottom: none;
        }

        .no-blockers {
            color: #4CAF50;
            font-weight: bold;
            text-align: center;
            padding: 20px;
        }

        .historical-nav {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .nav-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 20px;
            background: rgba(255,255,255,0.2);
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .nav-btn:hover, .nav-btn.active {
            background: rgba(255,255,255,0.3);
            transform: scale(1.05);
        }

        .standup-summary {
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            padding: 25px;
            margin-top: 20px;
        }

        .standup-summary h2 {
            color: #333;
            margin-bottom: 15px;
        }

        .emoji-breakdown {
            display: flex;
            justify-content: space-around;
            align-items: center;
            margin: 15px 0;
            flex-wrap: wrap;
            gap: 10px;
        }

        .emoji-stat {
            text-align: center;
            background: #f8f9fa;
            padding: 10px 15px;
            border-radius: 10px;
            min-width: 60px;
        }

        .emoji-stat .emoji {
            font-size: 1.5rem;
            display: block;
            margin-bottom: 5px;
        }

        .emoji-stat .count {
            font-weight: bold;
            color: #667eea;
        }

        .refresh-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            font-size: 1.2rem;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
        }

        .refresh-btn:hover {
            transform: scale(1.1);
            background: #5a67d8;
        }

        .no-data-message {
            text-align: center;
            color: #666;
            font-style: italic;
            padding: 20px;
        }

        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Team Vibe Check Dashboard ‚ú®</h1>
            <p id="current-date">Loading...</p>
        </div>

        <div class="historical-nav">
            <button class="nav-btn active" data-period="today">Today</button>
            <button class="nav-btn" data-period="yesterday">Yesterday</button>
            <button class="nav-btn" data-period="this-week">This Week</button>
            <button class="nav-btn" data-period="all-time">All Time</button>
        </div>

        <div class="dashboard-grid">
            <!-- Overall Team Mood -->
            <div class="card">
                <h3>üéØ Average Team Mood</h3>
                <div class="mood-indicator">
                    <div class="mood-score" id="avg-mood">--</div>
                    <div class="mood-emoji">üòé</div>
                </div>
                <div class="traffic-light yellow" id="mood-light"></div>
                <p><strong>Scale:</strong> 1 (üíÄ) to 10 (üî•)</p>
                <p id="mood-status">Waiting for responses...</p>
            </div>

            <!-- Energy Levels -->
            <div class="card">
                <h3>‚ö° Average Energy Level</h3>
                <div class="mood-indicator">
                    <div class="mood-score" id="avg-energy">--</div>
                    <div class="mood-emoji">üîã</div>
                </div>
                <div class="traffic-light yellow" id="energy-light"></div>
                <p><strong>Scale:</strong> 1 (‚ò†Ô∏è) to 10 (üöÄ)</p>
                <p id="energy-status">Waiting for responses...</p>
            </div>

            <!-- Emoji Vibes Breakdown -->
            <div class="card">
                <h3>üòä Team Vibe Breakdown</h3>
                <div class="emoji-breakdown" id="emoji-breakdown">
                    <div class="emoji-stat">
                        <span class="emoji">üò≠</span>
                        <span class="count" id="count-struggling">0</span>
                    </div>
                    <div class="emoji-stat">
                        <span class="emoji">üòê</span>
                        <span class="count" id="count-surviving">0</span>
                    </div>
                    <div class="emoji-stat">
                        <span class="emoji">üòé</span>
                        <span class="count" id="count-chillin">0</span>
                    </div>
                    <div class="emoji-stat">
                        <span class="emoji">üî•</span>
                        <span class="count" id="count-thriving">0</span>
                    </div>
                    <div class="emoji-stat">
                        <span class="emoji">ü§°</span>
                        <span class="count" id="count-chaos">0</span>
                    </div>
                </div>
            </div>

            <!-- Today's Responses -->
            <div class="card">
                <h3>üìã <span id="period-label">Today's</span> Responses</h3>
                <div id="response-count">
                    <strong>0 responses</strong>
                </div>
                <div class="team-responses" id="team-responses">
                    <p class="no-data-message">
                        Waiting for team responses...
                    </p>
                </div>
            </div>

            <!-- Current Blockers -->
            <div class="card">
                <h3>üöß Current Blockers</h3>
                <ul class="blockers-list" id="blockers-list">
                    <li class="no-data-message">
                        No blockers reported üéâ
                    </li>
                </ul>
            </div>
        </div>

        <!-- Standup Summary -->
        <div class="standup-summary">
            <h2>üéØ <span id="summary-period-label">Today's</span> Summary</h2>
            <div id="standup-summary-content">
                <p>Waiting for responses to generate summary...</p>
            </div>
        </div>
    </div>

    <button class="refresh-btn" onclick="manualRefresh()" title="Refresh Data">
        üîÑ
    </button>

    <script>
        // Your actual Google Sheet ID
        const SHEET_ID = '16s1gNOukiFeb1U4t_dHZBCKKaPcTEuD7Dbm_lNMUedg';
        const SHEET_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=Form%20Responses%201`;

        let currentData = [];
        let currentPeriod = 'today';

        // Helper function to get date ranges
        function getDateRange(period) {
            const now = new Date();
            const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
            
            switch(period) {
                case 'today':
                    return {
                        start: today,
                        end: new Date(today.getTime() + 24 * 60 * 60 * 1000)
                    };
                    
                case 'yesterday':
                    const yesterday = new Date(today.getTime() - 24 * 60 * 60 * 1000);
                    return {
                        start: yesterday,
                        end: today
                    };
                    
                case 'this-week':
                    const weekStart = new Date(today);
                    weekStart.setDate(today.getDate() - today.getDay()); // Start of week (Sunday)
                    return {
                        start: weekStart,
                        end: new Date(now.getTime() + 24 * 60 * 60 * 1000)
                    };
                    
                case 'all-time':
                    return {
                        start: new Date(2020, 0, 1), // Way back
                        end: new Date(now.getTime() + 24 * 60 * 60 * 1000)
                    };
                    
                default:
                    return getDateRange('today');
            }
        }

        // Update current date display
        function updateDateDisplay() {
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            
            switch(currentPeriod) {
                case 'today':
                    document.getElementById('current-date').textContent = 
                        new Date().toLocaleDateString('en-US', options);
                    break;
                case 'yesterday':
                    const yesterday = new Date();
                    yesterday.setDate(yesterday.getDate() - 1);
                    document.getElementById('current-date').textContent = 
                        'Yesterday - ' + yesterday.toLocaleDateString('en-US', options);
                    break;
                case 'this-week':
                    document.getElementById('current-date').textContent = 'This Week';
                    break;
                case 'all-time':
                    document.getElementById('current-date').textContent = 'All Time Data';
                    break;
            }
        }

        // Fetch data from Google Sheets
        async function fetchSheetData() {
            try {
                console.log('Fetching fresh data...');
                
                const response = await fetch(SHEET_URL);
                const text = await response.text();
                
                // Clean up Google's JSON response
                const jsonText = text.substring(47).slice(0, -2);
                const data = JSON.parse(jsonText);
                
                currentData = data.table.rows || [];
                updateDashboard();
                
                console.log('Data updated successfully!');
            } catch (error) {
                console.error('Error fetching data:', error);
                console.log('Make sure your Sheet ID is correct and sheet is public');
            }
        }

        // Filter data by selected time period
        function getFilteredData() {
            if (currentData.length === 0) return [];
            
            const { start, end } = getDateRange(currentPeriod);
            
            return currentData.filter(row => {
                if (!row.c[0] || !row.c[0].v) return false;
                
                // Handle both date objects and date strings
                let responseDate;
                if (typeof row.c[0].v === 'string') {
                    responseDate = new Date(row.c[0].v);
                } else {
                    responseDate = new Date(row.c[0].v);
                }
                
                // Check if date is valid
                if (isNaN(responseDate.getTime())) return false;
                
                return responseDate >= start && responseDate < end;
            });
        }

        // Update dashboard with filtered data
        function updateDashboard() {
            updateDateDisplay();
            
            const filteredResponses = getFilteredData();
            console.log(`Found ${filteredResponses.length} responses for ${currentPeriod}`);
            
            updateResponseCount(filteredResponses.length);
            
            if (filteredResponses.length > 0) {
                updateMoodAndEnergy(filteredResponses);
                updateEmojiBreakdown(filteredResponses);
                updateResponsesList(filteredResponses);
                updateBlockersList(filteredResponses);
                updateStandupSummary(filteredResponses);
            } else {
                showNoDataState();
            }
            
            updateLabels();
        }

        function updateLabels() {
            const periodLabels = {
                'today': "Today's",
                'yesterday': "Yesterday's",
                'this-week': "This Week's",
                'all-time': "All Time"
            };
            
            document.getElementById('period-label').textContent = periodLabels[currentPeriod];
            document.getElementById('summary-period-label').textContent = periodLabels[currentPeriod];
        }

        function showNoDataState() {
            document.getElementById('avg-mood').textContent = '--';
            document.getElementById('avg-energy').textContent = '--';
            document.getElementById('mood-status').textContent = 'No responses for this period';
            document.getElementById('energy-status').textContent = 'No responses for this period';
            
            // Reset emoji counts
            document.getElementById('count-struggling').textContent = '0';
            document.getElementById('count-surviving').textContent = '0';
            document.getElementById('count-chillin').textContent = '0';
            document.getElementById('count-thriving').textContent = '0';
            document.getElementById('count-chaos').textContent = '0';
            
            // Clear responses list
            document.getElementById('team-responses').innerHTML = 
                '<p class="no-data-message">No responses for this time period üì≠</p>';
            
            // Clear blockers
            document.getElementById('blockers-list').innerHTML = 
                '<li class="no-data-message">No data for this period</li>';
            
            // Clear summary
            document.getElementById('standup-summary-content').innerHTML = 
                '<p>No responses to summarize for this period.</p>';
            
            // Reset traffic lights
            document.getElementById('mood-light').className = 'traffic-light yellow';
            document.getElementById('energy-light').className = 'traffic-light yellow';
        }

        function updateResponseCount(count) {
            const periodText = currentPeriod === 'today' ? 'today' : 
                              currentPeriod === 'yesterday' ? 'yesterday' :
                              currentPeriod === 'this-week' ? 'this week' : 'total';
                              
            document.getElementById('response-count').innerHTML = 
                `<strong>${count} response${count !== 1 ? 's' : ''} ${periodText}</strong>`;
        }

        function updateMoodAndEnergy(responses) {
            // Actual columns: Timestamp, Mood, Energy, Emoji, Blockers, Email
            const moods = responses.map(row => row.c[1]?.v || 0).filter(v => v > 0);
            const energies = responses.map(row => row.c[2]?.v || 0).filter(v => v > 0);
            
            const avgMood = moods.length ? (moods.reduce((a, b) => a + b, 0) / moods.length).toFixed(1) : '--';
            const avgEnergy = energies.length ? (energies.reduce((a, b) => a + b, 0) / energies.length).toFixed(1) : '--';

            document.getElementById('avg-mood').textContent = avgMood;
            document.getElementById('avg-energy').textContent = avgEnergy;

            // Update traffic lights and status
            updateTrafficLight('mood-light', parseFloat(avgMood));
            updateTrafficLight('energy-light', parseFloat(avgEnergy));
            
            document.getElementById('mood-status').textContent = getMoodStatus(parseFloat(avgMood));
            document.getElementById('energy-status').textContent = getEnergyStatus(parseFloat(avgEnergy));
        }

        function updateEmojiBreakdown(responses) {
            const emojiCounts = {
                struggling: 0,
                surviving: 0,
                chillin: 0,
                thriving: 0,
                chaos: 0
            };

            responses.forEach(row => {
                const emoji = row.c[3]?.v || '';
                if (emoji.includes('üò≠')) emojiCounts.struggling++;
                else if (emoji.includes('üòê')) emojiCounts.surviving++;
                else if (emoji.includes('üòé')) emojiCounts.chillin++;
                else if (emoji.includes('üî•')) emojiCounts.thriving++;
                else if (emoji.includes('ü§°')) emojiCounts.chaos++;
            });

            document.getElementById('count-struggling').textContent = emojiCounts.struggling;
            document.getElementById('count-surviving').textContent = emojiCounts.surviving;
            document.getElementById('count-chillin').textContent = emojiCounts.chillin;
            document.getElementById('count-thriving').textContent = emojiCounts.thriving;
            document.getElementById('count-chaos').textContent = emojiCounts.chaos;
        }

        function updateResponsesList(responses) {
            const container = document.getElementById('team-responses');
            container.innerHTML = '';

            responses.forEach(row => {
                const email = row.c[5]?.v || 'Anonymous';
                const mood = row.c[1]?.v || 0;
                const energy = row.c[2]?.v || 0;
                const emoji = row.c[3]?.v || 'üòê';
                const timestamp = row.c[0]?.v ? new Date(row.c[0].v).toLocaleDateString() : 'Unknown date';
                
                const name = email.split('@')[0]; // Get name part of email
                
                const responseDiv = document.createElement('div');
                responseDiv.className = 'response-item';
                responseDiv.innerHTML = `
                    <div>
                        <strong>${name}</strong><br>
                        <small>Mood: ${mood}/10 | Energy: ${energy}/10</small><br>
                        ${currentPeriod !== 'today' ? `<small style="color: #999;">${timestamp}</small>` : ''}
                    </div>
                    <div class="response-emoji">${emoji.includes('üò≠') ? 'üò≠' : emoji.includes('üòê') ? 'üòê' : emoji.includes('üòé') ? 'üòé' : emoji.includes('üî•') ? 'üî•' : 'ü§°'}</div>
                `;
                container.appendChild(responseDiv);
            });
        }

        function updateBlockersList(responses) {
            const container = document.getElementById('blockers-list');
            container.innerHTML = '';

            const blockers = responses
                .map(row => ({
                    blocker: row.c[4]?.v,
                    email: row.c[5]?.v || 'Anonymous',
                    timestamp: row.c[0]?.v ? new Date(row.c[0].v).toLocaleDateString() : 'Unknown date'
                }))
                .filter(item => item.blocker && item.blocker.trim().length > 0);

            if (blockers.length === 0) {
                container.innerHTML = '<li class="no-blockers">No blockers reported! üéâ</li>';
            } else {
                blockers.forEach(item => {
                    const name = item.email.split('@')[0];
                    const li = document.createElement('li');
                    li.innerHTML = `
                        "${item.blocker}" 
                        <small style="color: #999;">- ${name} ${currentPeriod !== 'today' ? `(${item.timestamp})` : ''}</small>
                    `;
                    container.appendChild(li);
                });
            }
        }

        function updateStandupSummary(responses) {
            if (responses.length === 0) {
                document.getElementById('standup-summary-content').innerHTML = 
                    '<p>No responses to summarize for this period.</p>';
                return;
            }

            const avgMood = responses.reduce((sum, row) => sum + (row.c[1]?.v || 0), 0) / responses.length;
            const avgEnergy = responses.reduce((sum, row) => sum + (row.c[2]?.v || 0), 0) / responses.length;
            const blockersCount = responses.filter(row => row.c[4]?.v && row.c[4].v.trim().length > 0).length;
            
            let summary = `<p><strong>Team Status:</strong> `;
            
            if (avgMood >= 7 && avgEnergy >= 7) {
                summary += `Team is thriving! High mood (${avgMood.toFixed(1)}) and energy (${avgEnergy.toFixed(1)}).`;
            } else if (avgMood < 5 || avgEnergy < 5) {
                summary += `Team needs support. Low mood (${avgMood.toFixed(1)}) or energy (${avgEnergy.toFixed(1)}).`;
            } else {
                summary += `Team is doing okay. Mood: ${avgMood.toFixed(1)}/10, Energy: ${avgEnergy.toFixed(1)}/10.`;
            }
            
            summary += `</p>`;
            
            if (blockersCount > 0) {
                summary += `<p><strong>Action needed:</strong> ${blockersCount} team member${blockersCount > 1 ? 's have' : ' has'} reported blockers.</p>`;
            } else {
                summary += `<p><strong>Good news:</strong> No blockers reported!</p>`;
            }

            summary += `<p><strong>Responses:</strong> ${responses.length} team member${responses.length > 1 ? 's' : ''} responded.</p>`;

            document.getElementById('standup-summary-content').innerHTML = summary;
        }

        function updateTrafficLight(elementId, score) {
            const element = document.getElementById(elementId);
            element.className = 'traffic-light';
            if (score >= 7) {
                element.classList.add('green');
            } else if (score >= 5) {
                element.classList.add('yellow');
            } else if (score > 0) {
                element.classList.add('red');
            } else {
                element.classList.add('yellow');
            }
        }

        function getMoodStatus(score) {
            if (isNaN(score)) return "Waiting for responses...";
            if (score >= 8) return "Team is absolutely slaying! üî•";
            if (score >= 7) return "Good vibes all around ‚ú®";
            if (score >= 5) return "Doing okay, could be better";
            if (score >= 3) return "Team needs some support üíô";
            return "Emergency team meeting needed üö®";
        }

        function getEnergyStatus(score) {
            if (isNaN(score)) return "Waiting for responses...";
            if (score >= 8) return "Ready to conquer the world! üöÄ";
            if (score >= 7) return "High energy, good to go!";
            if (score >= 5) return "Moderate energy levels";
            if (score >= 3) return "Team looking tired...";
            return "Coffee emergency! ‚òï";
        }

        // Navigation functionality
        document.querySelectorAll('.nav-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                
                currentPeriod = this.getAttribute('data-period');
                console.log(`Switching to: ${currentPeriod}`);
                updateDashboard();
            });
        });

        // Manual refresh function
        function manualRefresh() {
            fetchSheetData();
        }

        // Auto-refresh every 2 minutes
        setInterval(fetchSheetData, 120000);

        // Load data when page loads
        document.addEventListener('DOMContentLoaded', () => {
            updateDateDisplay();
            fetchSheetData();
        });
    </script>
</body>
</html>
